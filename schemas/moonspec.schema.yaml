$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://moonrockz.github.io/moonspec/schemas/moonspec.schema.json"
title: Moonspec Configuration
description: Configuration for the moonspec BDD test framework.
type: object
additionalProperties: false

properties:
  world:
    type: string
    description: >
      World type name used for test generation (e.g. "CalcWorld").
      Must match a MoonBit struct that implements the World trait.

  mode:
    description: >
      Codegen mode for feature-to-test generation. Either a single mode
      applied to all features, or a map of feature file paths/globs to modes.
    oneOf:
      - type: string
        enum: ["per-scenario", "per-feature"]
        description: Apply this mode to all feature files.
      - type: object
        description: >
          Map of feature file paths or glob patterns to modes.
          Use "*" as the fallback default. More specific paths take precedence.
        additionalProperties:
          type: string
          enum: ["per-scenario", "per-feature"]
        examples:
          - {"features/checkout.feature": "per-feature", "*": "per-scenario"}

  skip_tags:
    type: array
    description: >
      Gherkin tags that cause scenarios to be skipped before execution.
      Each entry should include the @ prefix (e.g. "@skip", "@ignore").
      Scenarios tagged with any of these are reported as Skipped with
      the tag name or an optional reason extracted from the tag.
    default: ["@skip", "@ignore"]
    items:
      type: string
      pattern: "^@"
    examples: [["@skip", "@ignore", "@wip"]]

  formatters:
    type: array
    description: >
      Output formatters for test results. Each entry specifies a formatter
      type and output destination. If omitted, defaults to pretty on stdout.
    items:
      type: object
      required: ["type", "output"]
      additionalProperties: false
      properties:
        type:
          type: string
          enum: ["pretty", "junit", "messages"]
          description: Formatter type.
        output:
          type: string
          description: >
            Output destination: "stdout", "stderr", or a file path.
          examples: ["stdout", "stderr", "reports/results.xml"]
        no_color:
          type: boolean
          description: Disable ANSI colors (pretty formatter only).
          default: false
    examples:
      - [{"type": "pretty", "output": "stdout"}, {"type": "junit", "output": "reports/results.xml"}]

  steps:
    type: object
    description: Configuration for `moonspec gen steps` attribute scanning.
    additionalProperties: false
    properties:
      output:
        type: string
        description: >
          Where to write generated register_steps code.
          Built-in modes: "generated" (_generated/ directory),
          "alongside" (next to source files), "per-package" (one file per package).
          Any other value is treated as a custom output directory path.
        default: "generated"
        examples: ["generated", "alongside", "per-package", "my_gen/"]
      exclude:
        type: array
        description: >
          Glob patterns for files/directories to skip when scanning
          for #moonspec.* attributes.
        items:
          type: string
        examples: [["lib/*", "vendor/*"]]
